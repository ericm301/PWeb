/**
 * Copyright 2010 by Anadan. All rights reserved.
 * @author Anadan (aaafwd@gmail.com)
 */

(function(){function a(){chrome.extension.sendRequest({modifiedEvent:true})}function b(d,f){if(g){g.R();g.D&&a()}else if(f)g=new c;else if(d){g=new c(d.preserveDocWrite);f=d.filters||[];for(var h=0,j;j=f[h];++h){var k=[];j.value&&k.push(j.value);if(j.valueRegex)try{k.push(new RegExp(j.valueRegex,"i"))}catch(n){}g.filter(j.tags,null,j.attribute,k)}g.K(d.css).O(d.html).P(d.js).W(a).i()}}function c(d){this.n=[];this.o=this.e=this.g="";this.v=!!d;this.D=this.d=false;this.A=null}c.prototype.filter=function(d,
f,h,j,k){d=this.k(d);f=this.k(f);h=this.k(h);j=this.k(j);for(var n=0;n<d.length;++n){if(d[n]=="*")d[n]=null;for(var o=0;o<f.length;++o)for(var r=0;r<h.length;++r)for(var q=0;q<j.length;++q)if(!(h[r]&&typeof h[r]!="string"))if(h[r]&&/^class(Name)?$/i.test(h[r]))o==0&&this.n.push({tagName:d[n],className:j[q],t:null,value:null,B:k});else this.n.push({tagName:d[n],className:f[o],t:h[r],value:j[q],B:k})}return this};c.prototype.K=function(d){if(d)this.g+=d;return this};c.prototype.O=function(d){if(d)this.e+=
d;return this};c.prototype.P=function(d){if(d)this.o+=d;return this};c.prototype.W=function(d){this.A=d;return this};c.prototype.i=function(){function d(j){j=j.target;if(j instanceof HTMLElement&&j!=h){h=j;f.I(j)}}var f=this,h=null;document.addEventListener("DOMNodeInserted",d,true);document.addEventListener("DOMNodeInsertedIntoDocument",d,true);document.addEventListener("load",function(j){f.I(j.target)},true);window.addEventListener("DOMContentLoaded",function(){f.m()},true);window.addEventListener("load",
function(){f.d=true;f.m()},true);window.addEventListener("beforeload",function(j){var k=j.target;if(f.z(k&&k.parentNode)||f.z(k))j.preventDefault()},true);window.addEventListener("ModificationEvent",function(){f.j()},true);this.m();this.H(document.T)};c.prototype.R=function(){if(!this.d){this.d=true;this.m()}};c.prototype.m=function(){this.C(document);this.L();this.M();if(this.d||document.readyState=="complete"||document.readyState=="loaded"){this.d=true;this.N()}};c.prototype.Q=function(d,f){var h=
[];d=(f||d).getElementsByTagName("IFRAME");if(f&&f.nodeName.toLowerCase()=="iframe")d=[f].concat(d);f=0;for(var j;j=d[f];++f){var k=j.src;if(!k||/^(?:about:blank|javascript:.*)$/i.test(k))h.push(j)}return h};c.prototype.C=function(d,f){if(!(f&&!f.getElementsByClassName)){for(var h=[],j={},k={},n=0,o;o=this.n[n];++n){if(f&&this.w(f,o)){this.r(f);return}var r=o.B||d;if(f&&this.u(r,f))r=f;if(o.t=="id"&&typeof o.value=="string"){var q=d.getElementById(o.value);r=q&&this.u(r,q)?[q]:[]}else if(o.className&&
typeof o.className=="string"){q=o.className;r=k[q]=k[q]||r.getElementsByClassName(q)}else{q=o.tagName&&typeof o.tagName=="string"?o.tagName:"*";r=j[q]=j[q]||r.getElementsByTagName(q)}q=0;for(var z;z=r[q];++q)this.w(z,o)&&h.push(z)}for(n=0;q=h[n];++n)this.r(q);var I=this;this.Q(d,f).forEach(function(J){try{var p=J.contentDocument;p&&I.C(p)}catch(s){}})}};c.prototype.w=function(d,f){var h=d.nodeName.toLowerCase(),j=d.className,k=this.p(f.className,j);if(!k)if(j&&typeof j=="string"&&/\s/.test(j))for(var n=
this.k(j,/\s+/),o=0;j=n[o];++o)if(this.p(f.className,j)){k=true;break}return k&&this.p(f.tagName,h)&&this.u(f.B,d)&&this.S(d,f.t,f.value)};c.prototype.S=function(d,f,h){if(!f)return true;d=d.getAttribute&&d.getAttribute(f)||d[f];return h?this.p(h,d):!d};c.prototype.p=function(d,f){if(d){f=f||"";return typeof d=="string"?d.toLowerCase()==f.toLowerCase():d.test(f)}return true};c.prototype.u=function(d,f){if(!d||d==document||d==document.body)return true;for(;f;f=f.parentNode)if(f==d)return true;return false};
c.J=function(d,f){function h(p){var s;a:{s=f.getElementsByTagName("script");if(s=s.length?s[s.length-1]:null)if(s==n||k.test(s.outerHTML)){n=s;s=true;break a}s=false}if(s)return p;if(k.test(p)||o.test(p))return p;s=p;p=p.replace(r,"");p=p.replace(q,"");p=p.replace(z,"<!-- $1");p=p.replace(I,"$& <!-- --\>");if(!j&&s!=p){j=true;s=f.createEvent("Events");s.initEvent("ModificationEvent",true,true);d.dispatchEvent(s)}return p}var j=false,k=/<script[^>]*\ssrc\s*=\s*['"]?(?:\/?\w+[\/'"\?#]|https?:\/[^'"\?#]*[_\.\/-](?:api|maps|google\.com\/uds)[_\.\/-])/i,
n=null,o=/<embed[^>]*\ssrc\s*=\s*['"]?(?:\/?\w+[\/'"\?#]|https?:\/\/(?:\w+\.(ytimg|youtube)\.com)\/)/i,r=/<(script|iframe|object|embed)\b[^>]*\/>/ig,q=/<(script|iframe|object|embed)\b.*?<\/\1>/ig,z=/<(script|iframe|object|embed)\b/ig,I=/<\/(?:script|iframe|object|embed)>/ig,J=f.write;f.write=function(p){(p=h(p))&&J.call(f,p)};f.writeln=function(p){f.write(p+"\n")}};c.prototype.H=function(d){if(!this.v&&d){this.v=true;var f=document.createElement("script");f.appendChild(document.createTextNode("("+
c.J+")(window,document)"));try{d.appendChild(f)}catch(h){this.v=false}}};c.prototype.z=function(d){if(d)for(var f=0,h;h=this.n[f];++f)if(this.w(d,h)){this.r(d);return true}return false};c.prototype.I=function(d){if(d&&!this.z(d)){this.d&&this.C(document,d);this.H(document.T||d)}};c.prototype.r=function(d){var f=d.parentNode;if(f){var h=d.nodeName;f.removeChild(d);this.j();h.toLowerCase()=="embed"&&f.nodeName.toLowerCase()=="object"&&this.r(f)}};c.prototype.k=function(d,f){var h=[],j=[].concat(d);
for(d=0;d<j.length;++d)if(j[d]&&typeof j[d]=="string")h=h.concat(j[d].split(f||/\s*,\s*/));else h.push(j[d]);for(d=0;d<h.length;++d)if(h[d]&&typeof h[d]=="string")h[d]=h[d].replace(/^\s+|\s+$/g,"");else h[d]||(h[d]="");h.sort(function(k,n){return k<n?-1:1});for(f=d=0;d<h.length;++d)if(h[d]&&(!f||h[f-1]!=h[d]))h[f++]=h[d];h.length=f||1;return h};c.prototype.L=function(){var d=document.getElementsByTagName("head")[0]||document.documentElement;if(this.g&&d){var f=this.g;this.g="";try{var h=document.createElement("style");
h.type="text/css";h.appendChild(document.createTextNode(f));d.appendChild(h);this.j()}catch(j){this.g=f}}};c.prototype.M=function(){var d=document.body;if(this.e&&d){var f=this.e;this.e="";try{var h=document.createElement("div");h.innerHTML=f;for(var j=[],k=h.firstChild;k;k=k.nextSibling)j.push(k);h=[];for(var n=0;k=j[n];++n)k.nodeName&&k.nodeName.toLowerCase()=="script"&&(!k.type||k.type.toLowerCase()==="text/javascript")?h.push({src:k.src,U:k.text||k.textContent||k.innerHTML}):d.appendChild(k);
h.length&&(new e(h)).i(d);this.j()}catch(o){this.e=f}}};c.prototype.N=function(){if(!this.e&&this.o){var d=this.o;this.o="";try{eval(d);this.j()}catch(f){window.console.error("[PersonalizedWeb] Exception in custom JS code.\n  "+f)}}};c.prototype.j=function(){if(!this.D){this.D=true;this.A&&this.A()}};function e(d){this.V=d}e.prototype.i=function(d){function f(){for(;;){var k=h[j++];if(!k)break;if(k.src){e.F(d,k.src,null,f);break}else e.F(d,null,k.U)}}var h=this.V,j=0;f()};e.F=function(d,f,h,j){var k=
document.createElement("script");k.type="text/javascript";if(f)k.src=f;else h&&k.appendChild(document.createTextNode(h));if(j){var n=false;k.onload=k.onreadystatechange=function(){if(!n&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){n=true;j();k.onload=k.onreadystatechange=null}}}d.appendChild(k)};var g=null,i=window.location.href;window==top?chrome.extension.onRequest.addListener(function(d){b(d.rule,d.disabled)}):chrome.extension.sendRequest({url:i},function(d){b(d)})})();
