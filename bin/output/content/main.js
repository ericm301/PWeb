/**
 * Copyright 2010 by Anadan. All rights reserved.
 * @author Anadan (aaafwd@gmail.com)
 */

(function(){function a(){chrome.extension.sendRequest({modifiedEvent:true})}function b(d,f){if(g){g.R();g.D&&a()}else if(f)g=new c;else if(d){g=new c(d.preserveDocWrite);f=d.filters||[];for(var i=0,j;j=f[i];++i){var k=[];j.value&&k.push(j.value);if(j.valueRegex)try{k.push(new RegExp(j.valueRegex,"i"))}catch(m){}g.filter(j.tags,null,j.attribute,k)}g.K(d.css).O(d.html).P(d.js).W(a).i()}}function c(d){this.n=[];this.o=this.d=this.f="";this.v=!!d;this.D=this.c=false;this.A=null}c.prototype.filter=function(d,
f,i,j,k){d=this.k(d);f=this.k(f);i=this.k(i);j=this.k(j);for(var m=0;m<d.length;++m){if(d[m]=="*")d[m]=null;for(var n=0;n<f.length;++n)for(var r=0;r<i.length;++r)for(var q=0;q<j.length;++q)if(!(i[r]&&typeof i[r]!="string"))if(i[r]&&/^class(Name)?$/i.test(i[r]))n==0&&this.n.push({tagName:d[m],className:j[q],t:null,value:null,B:k});else this.n.push({tagName:d[m],className:f[n],t:i[r],value:j[q],B:k})}return this};c.prototype.K=function(d){if(d)this.f+=d;return this};c.prototype.O=function(d){if(d)this.d+=
d;return this};c.prototype.P=function(d){if(d)this.o+=d;return this};c.prototype.W=function(d){this.A=d;return this};c.prototype.i=function(){function d(j){j=j.target;if(j instanceof HTMLElement&&j!=i){i=j;f.I(j)}}var f=this,i=null;document.addEventListener("DOMNodeInserted",d,true);document.addEventListener("DOMNodeInsertedIntoDocument",d,true);document.addEventListener("load",function(j){f.I(j.target)},true);window.addEventListener("DOMContentLoaded",function(){f.m()},true);window.addEventListener("load",
function(){f.c=true;f.m()},true);window.addEventListener("beforeload",function(j){var k=j.target;if(f.z(k&&k.parentNode)||f.z(k))j.preventDefault()},true);window.addEventListener("ModificationEvent",function(){f.j()},true);this.m();this.H(document.T)};c.prototype.R=function(){if(!this.c){this.c=true;this.m()}};c.prototype.m=function(){this.C(document);this.L();this.M();if(this.c||document.readyState=="complete"||document.readyState=="loaded"){this.c=true;this.N()}};c.prototype.Q=function(d,f){var i=
[];d=(f||d).getElementsByTagName("IFRAME");if(f&&f.nodeName.toLowerCase()=="iframe")d=[f].concat(d);f=0;for(var j;j=d[f];++f){var k=j.src;if(!k||/^(?:about:blank|javascript:.*)$/i.test(k))i.push(j)}return i};c.prototype.C=function(d,f){if(!(f&&!f.getElementsByClassName)){for(var i=[],j={},k={},m=0,n;n=this.n[m];++m){if(f&&this.w(f,n)){this.r(f);return}var r=n.B||d;if(f&&this.u(r,f))r=f;if(n.t=="id"&&typeof n.value=="string"){var q=d.getElementById(n.value);r=q&&this.u(r,q)?[q]:[]}else if(n.className&&
typeof n.className=="string"){q=n.className;r=k[q]=k[q]||r.getElementsByClassName(q)}else{q=n.tagName&&typeof n.tagName=="string"?n.tagName:"*";r=j[q]=j[q]||r.getElementsByTagName(q)}q=0;for(var A;A=r[q];++q)this.w(A,n)&&i.push(A)}for(m=0;q=i[m];++m)this.r(q);var H=this;this.Q(d,f).forEach(function(I){try{var o=I.contentDocument;o&&H.C(o)}catch(s){}})}};c.prototype.w=function(d,f){var i=d.nodeName.toLowerCase(),j=d.className,k=this.p(f.className,j);if(!k)if(j&&typeof j=="string"&&/\s/.test(j))for(var m=
this.k(j,/\s+/),n=0;j=m[n];++n)if(this.p(f.className,j)){k=true;break}return k&&this.p(f.tagName,i)&&this.u(f.B,d)&&this.S(d,f.t,f.value)};c.prototype.S=function(d,f,i){if(!f)return true;d=d.getAttribute&&d.getAttribute(f)||d[f];return i?this.p(i,d):!d};c.prototype.p=function(d,f){if(d){f=f||"";return typeof d=="string"?d.toLowerCase()==f.toLowerCase():d.test(f)}return true};c.prototype.u=function(d,f){if(!d||d==document||d==document.body)return true;for(;f;f=f.parentNode)if(f==d)return true;return false};
c.J=function(d,f){function i(o){var s;a:{s=f.getElementsByTagName("script");if(s=s.length?s[s.length-1]:null)if(s==m||k.test(s.outerHTML)){m=s;s=true;break a}s=false}if(s)return o;if(k.test(o)||n.test(o))return o;s=o;o=o.replace(r,"");o=o.replace(q,"");o=o.replace(A,"<!-- $1");o=o.replace(H,"$& <!-- --\>");if(!j&&s!=o){j=true;s=f.createEvent("Events");s.initEvent("ModificationEvent",true,true);d.dispatchEvent(s)}return o}var j=false,k=/<script[^>]*\ssrc\s*=\s*['"]?(?:\/?\w+[\/'"\?#]|https?:\/[^'"\?#]*[_\.\/-](?:api|maps|google\.com\/uds)[_\.\/-])/i,
m=null,n=/<embed[^>]*\ssrc\s*=\s*['"]?(?:\/?\w+[\/'"\?#]|https?:\/\/(?:\w+\.(ytimg|youtube)\.com)\/)/i,r=/<(script|iframe|object|embed)\b[^>]*\/>/ig,q=/<(script|iframe|object|embed)\b.*?<\/\1>/ig,A=/<(script|iframe|object|embed)\b/ig,H=/<\/(?:script|iframe|object|embed)>/ig,I=f.write;f.write=function(o){(o=i(o))&&I.call(f,o)};f.writeln=function(o){f.write(o+"\n")}};c.prototype.H=function(d){if(!this.v&&d){this.v=true;var f=document.createElement("script");f.appendChild(document.createTextNode("("+
c.J+")(window,document)"));try{d.appendChild(f)}catch(i){this.v=false}}};c.prototype.z=function(d){if(d)for(var f=0,i;i=this.n[f];++f)if(this.w(d,i)){this.r(d);return true}return false};c.prototype.I=function(d){if(d&&!this.z(d)){this.c&&this.C(document,d);this.H(document.T||d)}};c.prototype.r=function(d){var f=d.parentNode;if(f){var i=d.nodeName;f.removeChild(d);this.j();i.toLowerCase()=="embed"&&f.nodeName.toLowerCase()=="object"&&this.r(f)}};c.prototype.k=function(d,f){var i=[],j=[].concat(d);
for(d=0;d<j.length;++d)if(j[d]&&typeof j[d]=="string")i=i.concat(j[d].split(f||/\s*,\s*/));else i.push(j[d]);for(d=0;d<i.length;++d)if(i[d]&&typeof i[d]=="string")i[d]=i[d].replace(/^\s+|\s+$/g,"");else i[d]||(i[d]="");i.sort(function(k,m){return k<m?-1:1});for(f=d=0;d<i.length;++d)if(i[d]&&(!f||i[f-1]!=i[d]))i[f++]=i[d];i.length=f||1;return i};c.prototype.L=function(){var d=document.getElementsByTagName("head")[0]||document.documentElement;if(this.f&&d){var f=this.f;this.f="";try{var i=document.createElement("style");
i.type="text/css";i.appendChild(document.createTextNode(f));d.appendChild(i);this.j()}catch(j){this.f=f}}};c.prototype.M=function(){var d=document.body;if(this.d&&d){var f=this.d;this.d="";try{var i=document.createElement("div");i.innerHTML=f;for(var j=[],k=i.firstChild;k;k=k.nextSibling)j.push(k);i=[];for(var m=0;k=j[m];++m)k.nodeName&&k.nodeName.toLowerCase()=="script"&&(!k.type||k.type.toLowerCase()==="text/javascript")?i.push({src:k.src,U:k.text||k.textContent||k.innerHTML}):d.appendChild(k);
i.length&&(new e(i)).i(d);this.j()}catch(n){this.d=f}}};c.prototype.N=function(){if(!this.d&&this.o){var d=this.o;this.o="";try{eval(d);this.j()}catch(f){window.console.error("[PersonalizedWeb] Exception in custom JS code.\n  "+f)}}};c.prototype.j=function(){if(!this.D){this.D=true;this.A&&this.A()}};function e(d){this.V=d}e.prototype.i=function(d){function f(){for(;;){var k=i[j++];if(!k)break;if(k.src){e.F(d,k.src,null,f);break}else e.F(d,null,k.U)}}var i=this.V,j=0;f()};e.F=function(d,f,i,j){var k=
document.createElement("script");k.type="text/javascript";if(f)k.src=f;else i&&k.appendChild(document.createTextNode(i));if(j){var m=false;k.onload=k.onreadystatechange=function(){if(!m&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){m=true;j();k.onload=k.onreadystatechange=null}}}d.appendChild(k)};var g=null,h=window.location.href;window==top?chrome.extension.onRequest.addListener(function(d){b(d.rule,d.disabled)}):chrome.extension.sendRequest({url:h},function(d){b(d)})})();
